<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Exercise 2 Guide</title>
  <link rel="stylesheet" href="../assets/css/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="container topbar__inner">
      <div class="brand">
        <img class="brand__mark" src="../assets/images/logo.svg" alt="POC Hub"/>
        <div class="brand__text">
          <div class="brand__title">POC Hub</div>
          <div class="brand__subtitle">InterSystems IRIS for Health • Exercise 2</div>
        </div>
      </div>

      <nav class="quicklinks" aria-label="Quick links">
        <a class="chip" href="../index.html">Back to Home</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- HERO (matches installation guide structure) -->
    <section class="hero">
      <h1>POC Exercise 2: FHIR-to-SQL</h1>
      <p>
        Use the instructions on this page to complete the exercise. The checklists can track progress (saved in browser).
      </p>
    </section>

    <!-- OVERVIEW / SUCCESS -->
    <section class="section">
      <div class="section__header">
        <h2>Exercise Overview</h2>
        <p class="muted">Unity Health Toronto is seeking to ingest FHIR resources directly into SQL tables stored in IRIS that can be exposed externally for downstream analytics and research.</p>
        <br/>
        <p class="muted">In this exercise, we will demonstrate how IRIS simplifies FHIR server creation and efficiently maps FHIR data into a SQL table. We will leverage the same built-in IRIS tools from Exercise One to create this FHIR-to-SQL pipeline. We will examine the data through a combination of IRIS tools and external tools (SQL client and REST client).
          </p>
        <br/>
      </div>

      <details class="details details--accent" >
        <summary>Measures of Success</summary>
        <div class="details__content">
          <ul class="bullets">
            <li>Successful ingestion and transformation of FHIR R4 Patient Resources into a SQL table.</li>
            <li>Successful access to the tabular data</li>
            <li>Successful data query through a FHIR endpoint.</li>
          </ul>
          <p class="muted" style="margin-top:10px;">
            Validation of this success will be accomplished using tools available through IRIS (Visual Trace, SQL Engine), an external SQL database (PostgreSQL), and an external REST client (Postman) at the end of this exercise
          </p>
        </div>
      </details>
    </section>

    <!-- PRE-REQUISITES -->
    <section id="prereqs" class="section">
      <div class="section__header">
        <h2>Pre-requisites</h2>
        <p class="muted">Complete these prerequisites before building the interoperability pipeline.</p>
      </div>

      <details class="details details--accent">
        <summary>Pre-requisites</summary>
        <br/>

        <form class="checklist" data-checklist-id="exercise-1-prereqs">

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>1.</strong> Install Postman on your local machine (outside of the Google VM).</code></pre>
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
        </form>
      </details>
    </section>

    <!-- FHIR Endpoint Setup -->
    <section id="fhir" class="section">
      <div class="section__header">
        <h2>FHIR Server Setup</h2>
        <p class="muted">Configure a new interoperability-enabled FHIR server and endpoint.</p>
      </div>

      <details class="details details--accent">
        <summary>FHIR Server Configuration</summary>

        <div class="details__content">
          <p class="muted">We will configure a new FHIR server and its corresponding endpoint in your namespace.</p>
        </div>

        <form class="checklist" data-checklist-id="exercise-1-sql-transformation">
          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>1.</strong> From the homepage of the Management Portal, select your namespace (i.e. <code>UNITY</code>).
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>2.</strong> On the left-side menu, click <code>Health.</code> This pulls up the page for healthcare tool management, such as FHIR server configuration.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>3.</strong> From the Health page, click <code>FHIR Server Management.</code>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>4.</strong> Click the <code>Add new server</code> button.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>5.</strong> Configure as follows:
              <ul class="bullets">
                <li><strong>Namespace:</strong> &lt;Select your namespace (i.e. <code>UNITY</code>)&gt;</li>
                <li><strong>Name:</strong> &lt;Name of your namespace (i.e. <code>UNITY</code>, but can be anything)&gt;</li>
                <li><strong>FHIR Version:</strong> FHIR R4</li>
                <li><strong>URL:</strong> &lt;Keep the default (i.e. <code>/csp/healthshare/unity/fhir/r4</code>)&gt;</li>
                <li><strong>Custom Packages:</strong> hl7.fhir.us.core@3.1.0</li>
              </ul>

              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <img src="../assets/images/exercise2/1-fhir-server-config.png" alt="Production page" />
                </div>
              </details>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>6.</strong> Click <code>Create</code>. The FHIR server and endpoint creation may take a couple of minutes.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>7.</strong> Once FHIR server and endpoint creation is done, click the <code>Home</code> link in the top right corner to return to the Management Portal Home page.
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
          </form>
      </details>

      <details class="details details--accent">
        <summary>FHIR Interoperability Configuration</summary>

        <div class="details__content">
          <p class="muted">We will create interoperability components that accept FHIR requests and pass all FHIR requests and responses through the interoperability production created in Exercise 1.</p>
        </div>

        <form class="checklist" data-checklist-id="exercise-1-sql-transformation">
          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>1.</strong> On the Management Portal home page, make sure we are in your POC namespace (i.e. <code>UNITY</code>).
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>2.</strong> Navigate to Interoperability → Configure → Production. This should open the production we built last week.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>3.</strong> Create a new business service with the following configurations (on the <code>All Services</code> tab):
              <ul class="bullets">
                <li><strong>Service Class:</strong> HS.FHIRServer.Interop.Service</li>
                <li><strong>Service Name:</strong> FHIRIn</li>
                <li><strong>Display Category:</strong> Exercise 2 (you will likely need to type this in)</li>
                <li><strong>Enable Now:</strong> Checked</li>
                <li>Click <code>OK.</code></li>
              </ul>

              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <div><p class="muted">Start by clicking this <code>+</code> button next to "Services."</p></div>
                  <img src="../assets/images/exercise2/2-add-service.png" alt="Create Service" />
                </div>
              </details>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>4.</strong> Create a new business operation with the following configurations (on the <code>All Operations</code> tab):
              <ul class="bullets">
                <li><strong>Operation Class:</strong> HS.FHIRServer.Interop.Operation</li>
                <li><strong>Operation Name:</strong> FHIROut</li>
                <li><strong>Display Category:</strong> Exercise 2</li>
                <li><strong>Enable Now:</strong> checked</li>
                <li>Click <code>OK.</code></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>5.</strong> Create a new business operation with the following configurations (on the <code>All Services</code>):
              <ul class="bullets">
                <li><strong>Operation Class:</strong> HS.FHIRServer.Interop.Operation</li>
                <li><strong>Operation Name:</strong> FHIROut</li>
                <li><strong>Display Category:</strong> Exercise 2</li>
                <li><strong>Enable Now:</strong> checked</li>
                <li>Click <code>OK.</code></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>6.</strong> Click on the <code>FHIRIn</code> business service we created previously. In the settings panel, configure the following under the Basic Settings section:
              <ul class="bullets">
                <li><strong>Target Config Name:</strong> FHIROut</li>
                <li>Click Apply at the top of the settings panel to save this setting.</li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>7.</strong> Return to the home page of the Management Portal.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>8.</strong> Click <code>Health.</code> Then, on the Health page, click <code>FHIR Server Management.</code>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>9.</strong> Click the three horizontal bars on the top right of the card for your FHIR server/endpoint (i.e. UNITY).
              
              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <img src="../assets/images/exercise2/4-three-bars.png" alt="Edit FHIR Config" />
                </div>
              </details>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>10.</strong> On the menu that pops up, click <code>Edit</code>.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>11.</strong> Expand the <code>FHIR Server Service Configuration</code> setting.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3"/>
            <span>
              <strong>12.</strong> Under <code>Service Config Name</code>, use the dropdown to select <code>FHIRIn.</code> Click <code>Save</code>.
            
              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <img src="../assets/images/exercise2/3-fhir-config.png" alt="Configure FHIR Service" />
                </div>
              </details>
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
          </form>
      </details>

      <details class="details details--accent">
        <summary>(Optional) Test the New FHIR Endpoint</summary>

        <div class="details__content">
          <p class="muted">We will practice making FHIR REST calls to the IRIS FHIR Server through Postman.</p>
        </div>

        <form class="checklist" data-checklist-id="exercise-1-sql-transformation">
          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>1.</strong> On the FHIR Server Management page, copy the URL from your FHIR endpoint's card (i.e. /csp/healthshare/unity/fhir/r4).
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>2.</strong> If the production in your namespace is not yet running, go to the Home page and then in your namespace, navigate to Interoperability → Configure → Production. Click <code>Start.</code>
            </span>
          </label>

          <form class="checklist" data-checklist-id="exercise-1-sql-transformation">
            <label class="checklist__item">
              <input type="checkbox" data-step="2" />
              <span>
                <strong>3.</strong> Within Postman, create a new GET request.
              </span>
            </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>4.</strong> For the URL, enter: <pre><code>http://&lt;hostname&gt;/irishealth/&lt;URL copied in step 1 (i.e. csp/healthshare/unity/fhir/r4)&gt;/metadata</code></pre>
              
              <br/>
              Run the request. You should see a capability statement that displays valid interactions and operations for the IRIS FHIR Server.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>5.</strong> Edit the URL by replacing "metadata" with "Patient" (i.e. <code>http://&lt;hostname&gt;/irishealth/csp/healthshare/unity/fhir/r4/Patient</code>)
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>6.</strong> In Postman, navigate to the <code>Authorization</code> tab. Select <code>Basic Auth</code> for the Auth Type. Enter your credentials for logging into IRIS (such as SuperUser).
              
              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <img src="../assets/images/exercise2/5-basic-auth.png" alt="Postman Basic Auth" />
                </div>
              </details>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>7.</strong> Run the request. You should see a response saying no Patients are found.

              <details class="hint">
                <summary>Output</summary>
                <div class="hint__content">
                  <img src="../assets/images/exercise2/6-fhir-output.png" alt="Postman Basic Auth" />
                </div>
              </details>
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
        </form>

      </details>

    </section>


    <!-- FHIR-to-SQL DATA TRANSFORMATION -->
    <section id="dtl" class="section">
      <div class="section__header">
        <h2>Build a FHIR-to-SQL Data Transformation</h2>
        <p class="muted">Create a data transformation to extract from a FHIR Patient resource into the SQL tables from Exercise 1.</p>
      </div>

      <details class="details details--accent">
        <summary>Build a FHIR-to-SQL Data Transformation</summary>

        <div class="details__content">
          <p class="muted">We will practice creating a rule router and data transformation for inbound FHIR data from scratch.</p>
        </div>

        <form class="checklist" data-checklist-id="exercise-2-sql-transformation">
        <label class="checklist__item">
          <input type="checkbox" data-step="6" />
          <span><strong>1.</strong> From the Home page of the Management Portal, navigate to Interoperability → Build → Data Transformations.
          </span>
        </label>

        <label class="checklist__item">
          <input type="checkbox" data-step="6" />
          <span><strong>2.</strong> In the top left corner, click <code>New.</code> Configure the following:
            <ul class="bullets">
              <li><strong>Package:</strong> UNITYPKG.DTL (this might be different depending on your namespace)</li>
              <li><strong>Name:</strong> FHIRtoSQLPatientSubtransform</li>
              <li><strong>Source Type:</strong>
              <ul class="bullets">
                <li>Click the magnifying glass next to <code>Source Class</code> text box.</li>
                <li>In the pop-up, select on the leftmost pane: <code>All Non-System Classes</code></li>
                <li>Select: HS → FHIR → DTL → vR4 → Model → Resource → Patient</li>
              </ul></li>
              <li><strong>Target Type:</strong>
              <ul class="bullets">
                <li>Click the magnifing glass next to <code>Target Class</code> text box.</li>
                <li>In the pop-up, select on the leftmost pane: <code>Persistent Classes</code></li>
                <li>Select: uhtpoc → Patient</li>
                </ul>
              </li>

              <li>Click <code>OK</code></li>.
            </ul>
          </span>
        </label>

        <label class="checklist__item">
          <input type="checkbox" data-step="6" />
          <span><strong>3.</strong> Create a <code>set</code> action with the following configuration:
            <ul class="bullets">
              <li><strong>Property:</strong> <pre><code>target.mrn</code></pre></li>
              <li><strong>Value:</strong> <pre><code>source.identifier.(1).id</code></pre></li>
            </ul>
          </code>
          </span>
        </label>

        <label class="checklist__item">
          <input type="checkbox" data-step="6" />
          <span><strong>4.</strong> Create a <code>set</code> action with the following configuration:
            <ul class="bullets">
              <li><strong>Property:</strong> <pre><code>target.firstname</code></pre></li>
              <li><strong>Value:</strong> <pre><code>source.name.(1).given.(1)</code></pre></li>
            </ul>
          </code>
          </span>
        </label>

        <label class="checklist__item">
          <input type="checkbox" data-step="6" />
          <span><strong>5.</strong> Create a <code>set</code> action with the following configuration:
            <ul class="bullets">
              <li><strong>Property:</strong> <pre><code>target.lastname</code></pre></li>
              <li><strong>Value:</strong> <pre><code>source.name.(1).family</code></pre></li>
            </ul>
          </code>
          </span>
        </label>

        <label class="checklist__item">
          <input type="checkbox" data-step="6" />
          <span><strong>6.</strong> Create a <code>set</code> action with the following configuration:
            <ul class="bullets">
              <li><strong>Property:</strong> <pre><code>target.dateofbirth</code></pre></li>
              <li><strong>Value:</strong> <pre><code>$System.SQL.TODATE(source.birthDate,"YYYY-MM-DD")</code></pre></li>
            </ul>
          </code>
          </span>
        </label>

        <label class="checklist__item">
          <input type="checkbox" data-step="6" />
          <span><strong>7.</strong> Create a <code>set</code> action with the following configuration:
            <ul class="bullets">
              <li><strong>Property:</strong> <pre><code>target.gender</code></pre></li>
              <li><strong>Value:</strong> <pre><code>source.gender</code></pre></li>
            </ul>
          </code>
          </span>
        </label>

        <label class="checklist__item">
          <input type="checkbox" data-step="6" />
          <span><strong>8.</strong> Create a <code>set</code> action with the following configuration:
            <ul class="bullets">
              <li><strong>Property:</strong> <pre><code>target.phone</code></pre></li>
              <li><strong>Value:</strong> <pre><code>source.contact.(1).telecom.(1).value</code></pre></li>
            </ul>
          </code>
          </span>
        </label>

        <label class="checklist__item">
          <input type="checkbox" data-step="6" />
          <span><strong>9.</strong> Create a <code>sql</code> action with the following SQL statement:
            <br/>
            
            <pre><code>INSERT INTO uhtpoc.Patient 
(mrn, first_name, last_name, date_of_birth, gender, phone) 
VALUES (target.mrn, 
target.firstname, 
target.lastname, 
target.dateofbirth, 
target.gender, 
target.phone)</code></pre>
          </code>
          </span>
        </label>

        <label class="checklist__item">
          <input type="checkbox" data-step="6" />
          <span><strong>10.</strong> Click <code>Compile</code>.
          </span>
        </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>11.</strong> In the top left corner, click <code>New</code>. Configure the following:
              <ul class="bullets">
                <li><strong>Package:</strong> UNITYPKG.DTL (this might be different depending on your namespace)</li>
                <li><strong>Name:</strong> FHIRtoSQL</li>
                <li><strong>Source Type:</strong>
                <ul class="bullets">
                  <li>Click the magnifying glass next to <code>Source Class</code> text box.</li>
                  <li>In the pop-up, select on the leftmost pane: <code>All Non-System Classes</code></li>
                  <li>Select: HS → FHIRServer → Interop → Request</li>
                </ul></li>
                <li><strong>Target Type:</strong>
                <ul class="bullets">
                  <li>Click the magnifying glass next to <code>Target Class</code> text box.</li>
                  <li>In the pop-up, select on the leftmost pane: <code>Persistent Classes</code></li>
                  <li>Select: uhtpoc → Patient</li>
                  </ul>
                </li>
  
                <li>Click <code>OK</code></li>.
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="6" />
            <span><strong>12.</strong> Create a <code>set</code> action with the following configuration:
              <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>resourceStream</code></pre></li>
                <li><strong>Value:</strong> <pre><code>##class(HS.SDA3.QuickStream).%OpenId(source.QuickStreamId)</code></pre></li>
              </ul>
            </code>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="6" />
            <span><strong>13.</strong> Create a <code>set</code> action with the following configuration:
              <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>resource</code></pre></li>
                <li><strong>Value:</strong> <pre><code>##class(HS.FHIR.DTL.vR4.Model.Resource.Patient).FromJSON(resourceStream,"vR4")</code></pre></li>
              </ul>
            </code>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="6" />
            <span><strong>14.</strong> Create a <code>subtransform</code> action with the following configuration:
              <ul class="bullets">
                <li><strong>Transform Class:</strong> <pre><code>UNITYPKG.DTL.FHIRtoSQLPatientSubtransform</code></pre></li>
                <li><strong>Source:</strong> <pre><code>resource</code></pre></li>
                <li><strong>Target:</strong> <pre><code>target</code></pre></li>
              </ul>
            </code>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="6" />
            <span><strong>15.</strong> Click on <code>Compile</code>.
            </code>
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
        </form>
      </details>
    </section>

    <!-- FHIR BUSINESS RULES AND ROUTING -->
    <section id="routing" class="section">
      <div class="section__header">
        <h2>FHIR Business Rules and Routing</h2>
        <p class="muted">Configure a routing engine and routing rules for the FHIR data.</p>
      </div>

      <details class="details details--accent">
        <summary>FHIR Business Rule and Routing</summary>
        <br/>

        <div class="details__content">
          <p class="muted">
            We will configure data ingestion, business rules, and routing for our HL7v2 messages.
          </p>
        </div>

        <form class="checklist" data-checklist-id="exercise-1-routing">
          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span><strong>1.</strong> From the home page, navigate to Interoperability → Configure → Production.</span>
          </label>

            <label class="checklist__item">
              <input type="checkbox" data-step="4" />
              <span><strong>2a.</strong> Create a new business process with the following configuration:
              <ul class="bullets">
                <li><strong>Business Process Class: </strong>EnsLib.MsgRouter.RoutingEngine</li>
                <li><strong>Auto-Create Rule:</strong> Checked</li>
                <li><strong>New Rule Package: </strong> UNITYPKG.Rule (the parent package might have a slightly different name like UNITY1PKG, depending on your namespace name)</li>
                <li><strong>Business Process Name: </strong>FHIRRouter</li>
                <li><strong>Display Category:</strong> Exercise 2</li>
                <li><strong>Enable Now:</strong> Checked</li>
                <li>Click <code>OK.</code></li>
              </ul></span>
            </label>

            <label class="checklist__item">
              <input type="checkbox" data-step="5" />
              <span><strong>2b.</strong> Click on FHIRRouter and in the settings panel, scroll to Additional Settings. Configure the following:
              <ul class="bullets">
                <li><strong>Response From:</strong> FHIROut</li>
              </ul> </span>

              <br/>
              This enables the router to return responses that come from this specific downstream operation.
            </label>
  
            <label class="checklist__item">
              <input type="checkbox" data-step="5" />
              <span><strong>3.</strong> Click on your new message router. From the settings panel (Basic Settings), click the magnifying glass next to the <code>Business Rule Name</code> configuration to open the auto-created business rule. </span>
            </label>
  
  
            <label class="checklist__item">
              <input type="checkbox" data-step="6" />
              <span><strong>4.</strong> Configure a new rule as follows:
                <ul class="bullets">
                  <li><strong>Name:</strong> FHIRtoSQLPatient</li>
                  <li><strong>Source:</strong> FHIRIn</li>
                  <li><strong>Message Class:</strong> HS.FHIRServer.Interop.Request</li>
                  <li>Click <code>OK.</code></li>
                </ul>
              </span>
            </label>
  
  
            <label class="checklist__item">
              <input type="checkbox" data-step="7" />
              <span><strong>5.</strong> Click <code>+condition</code> to add a new condition (for filtering based on message content).</span>
            </label>
  
            <label class="checklist__item">
              <input type="checkbox" data-step="8" />
              <span><strong>6.</strong> Double click on the new condition and configure it as follows:
              <ul class="bullets">
                <li><strong>Value:</strong> 1</li>
                <li>Click <code>OK</code>.</li>
              </ul></span>
            </label>
  
            <label class="checklist__item">
              <input type="checkbox" data-step="8" />
              <span><strong>7.</strong> Click on <code>then</code> or <code>actions</code>. Then select <code>+send</code>.</span>
            </label>
  
            <label class="checklist__item">
              <input type="checkbox" data-step="9" />
              <span><strong>8.</strong> Double click the send action and configure as follows:
              <ul class="bullets">
                <li><strong>Value:</strong> PostgreSQLPatient</li>
                <li><strong>Transform:</strong> UNITYPKG.DTL.FHIRtoSQL</li>
              </ul></span>
            </label>
  
            <label class="checklist__item">
              <input type="checkbox" data-step="10" />
              <span><strong>9.</strong> Click on <code>then</code> or <code>actions</code>. Then select <code>+send</code> to add a second send action.</span>
            </label>
  
            <label class="checklist__item">
              <input type="checkbox" data-step="9" />
              <span><strong>10.</strong> Double click the newest send action and configure as follows:
              <ul class="bullets">
                <li><strong>Value:</strong> FHIROut</li>
                <li><strong>Transform:</strong> &lt;Leave this blank&gt;</li>
              </ul></span>
            </label>
  
            <label class="checklist__item">
              <input type="checkbox" data-step="10" />
              <span><strong>11.</strong> Click compile.</span>
            </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
        </form>
      </details>
    </section>

    <!-- DATA INGESTION AND VALIDATION -->
    <section id="validate" class="section">
      <div class="section__header">
        <h2>Data Ingestion and Validation</h2>
        <p class="muted">Feed data through the production and validate IRIS + PostgreSQL tables.</p>
      </div>

      <details class="details details--accent">
        <summary>Data Ingestion and Validation</summary>
        <br/>

        <form class="checklist" data-checklist-id="exercise-1-validate">

          <div class="details__content">
            <p class="muted">In this section, we will feed data through the interoperability production and validate that it has populated our FHIR Server and tables. We will start by POSTing the FHIR data and then querying the FHIR Server directly.</p>
          </div>

          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span><strong>1. </strong>If the production isn't already started yet, click the <code>Start</code> button on the production configuration page.</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <!-- TODO: make these folders -->
            <span><strong>2. </strong>Download these FHIR Patient resources: 
              <ul>
                <li>FHIR_Patient1.txt  <a
                  href="../assets/downloads/FHIR_Patient1.txt"
                  download
                  target="_blank"
                  class="btn btn--icon"
                  aria-label="Download FHIR_Patient1.txt"
                  title="Download FHIR_Patient1.txt"
                >
                  <img
                    src="../assets/images/download.svg"
                    alt=""
                    aria-hidden="true"
                  />
                </a></li>

              <li>FHIR_Patient2.txt  <a
                href="../assets/downloads/FHIR_Patient2.txt"
                download
                target="_blank"
                class="btn btn--icon"
                aria-label="Download FHIR_Patient2.txt"
                title="Download FHIR_Patient2.txt"
              >
                <img
                  src="../assets/images/download.svg"
                  alt=""
                  aria-hidden="true"
                />
              </a></li>
              <li>FHIR_Patient3.txt <a
                href="../assets/downloads/FHIR_Patient3.txt"
                download
                target="_blank"
                class="btn btn--icon"
                aria-label="Download FHIR_Patient3.txt"
                title="Download FHIR_Patient3.txt"
              >
                <img
                  src="../assets/images/download.svg"
                  alt=""
                  aria-hidden="true"
                />
              </a></li>
              </ul></span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span><strong>3. </strong>Create a new POST request in Postman.</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>4. </strong>For the URL, enter:
              <pre><code>http://&lt;hostname&gt;/irishealth/&lt;URL copied in step 1&gt;/metadata</code></pre>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>5. </strong> Set the Authorization to <code>Basic Authorization</code>. Enter your IRIS username and password (i.e. SuperUser account).
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>6. </strong> In the Headers tab, add the following:
              <ul class="bullets">
                <li><strong>Key:</strong> <pre><code>Content-Type</code></pre></li>
                <li><strong>Value:</strong> <pre><code>application/fhir+json</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>7. </strong> In the body, paste the text from the <code>FHIR_Patient1.txt</code> file you downloaded earlier.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>8. </strong> Run the request. You should see a 201 success code, indicating the resource has been successfully posted to the FHIR Server.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>9. </strong> Repeat steps 1-8 for the other two files downloaded earlier (<code>FHIR_Patient2.txt</code>,<code>FHIR_Patient3.txt</code>).
            </span>
          </label>

          <div class="details__content">
            <p class="muted">
              We will validate successful data ingestion by querying the data through a built-in SQL engine in IRIS. This will surface data stored in InterSystems IRIS's embedded database.
            </p>
          </div>

          <label class="checklist__item">
            <input type="checkbox" data-step="5" />
            <span><strong>10. </strong>From the Home page of the Management Portal, navigate to System Explorer → SQL.</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="7" />
            <span><strong>11. </strong>In the text box at the center of the page, enter the following query: 
              <pre><code>SELECT * FROM uhtpoc.Patient</code></pre></span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="8" />
            <span><strong>8. </strong>Click the Execute button above the query text box.

              You should see three new patients that we POSTed through IRIS earlier.
            </span>
          </label>

          <div class="details__content">
            <p class="muted">Next, we will connect to the external PostgreSQL database to query this data outside of IRIS.</p>
          </div>

          <label class="checklist__item">
            <input type="checkbox" data-step="12" />
            <span><strong>9. </strong>In your VM terminal, run: 
              <pre><code>PGPASSWORD='SYS' psql -h localhost -p 5432 -U superuser -d uhtpoc -c "SELECT * FROM Patient;"</code></pre></span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
        </form>
      </details>
    </section>
  </main>

  <footer class="footer">
    <div class="container footer__inner">
      <span class="muted">Exercise 1</span>
      <span class="muted">Progress saved locally</span>
    </div>
  </footer>

  <script src="../assets/js/app.js"></script>
</body>
</html>
