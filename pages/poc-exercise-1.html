<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Exercise 1 Guide</title>
  <link rel="stylesheet" href="../assets/css/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="container topbar__inner">
      <div class="brand">
        <img class="brand__mark" src="../assets/images/logo.svg"/>
        <div class="brand__text">
          <div class="brand__title">POC Hub</div>
          <div class="brand__subtitle">InterSystems IRIS for Health â€¢ Exercise 1</div>
        </div>
      </div>

      <nav class="quicklinks" aria-label="Quick links">
        <a class="chip" href="../index.html">Back to Home</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="section">
      <div class="section__header">
        <h1 class="h1">POC Exercise 1</h1>
        <p class="muted">Use the instructions on this page to complete the exercise. The checklists can track progress (saved in browser).</p>
      </div>

      <!-- POC Details, expandable -->
      <details class="details details--accent" open>
        <summary>Measures of Success</summary>
        <div class="details__content">
          <ul class="bullets">
            <li>Success metric #1 (e.g., endpoint responds with expected payload).</li>
            <li>Success metric #2 (e.g., performance threshold met).</li>
            <li>Success metric #3 (e.g., logging/monitoring validated).</li>
          </ul>
        </div>
      </details>

      <details class="details details--accent" open>
        <summary>Exercise 1 Details</summary>
        <div class="details__content">
          <ul class="bullets">
            <li>Success metric #1 (e.g., endpoint responds with expected payload).</li>
            <li>Success metric #2 (e.g., performance threshold met).</li>
            <li>Success metric #3 (e.g., logging/monitoring validated).</li>
          </ul>
        </div>
      </details>
    </section>

    <section class="section">
      <div class="section__header">
        <h2>Step-by-Step Instructions</h2>
        <p class="muted">Progress is saved automatically in your browser.</p>
      </div>

      <div class="card card--plain">
        <!-- data-checklist-id MUST be unique per page -->
        <form class="checklist" data-checklist-id="exercise-1">
          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span>Confirm prerequisites (access, credentials, network, tooling)</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>Deploy required components for this exercise</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>Configure settings and validate connectivity</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>Run test workflow and capture outputs</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="5" />
            <span>Verify measures of success and document results</span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>
              Reset checklist
            </button>
          </div>
        </form>
      </div>
    </section>

        <!-- PostgreSQL Export -->
        <section class="section">
          <div class="section__header">
            <h2>PostgreSQL Export</h2>
            <p class="muted">Install PostgreSQL, create schema, create user, install JDBC driver, and validate connectivity.</p>
          </div>
          <details class="details" open>
            <summary>Deployment Context</summary>
            <div class="details__content">
              <ul class="bullets">
                <li>PostgreSQL and InterSystems IRIS run on the <strong>same Google Compute Engine VM</strong></li>
                <li>PostgreSQL listens on <code>localhost:5432</code></li>
                <li>No GCE firewall rule is required for PostgreSQL</li>
                <li>Only port <strong>80</strong> (and optionally <strong>443</strong>) must be exposed externally for IRIS</li>
                <li>JDBC connections from IRIS use the local loopback interface</li>
              </ul>
            </div>
          </details>          
    
          <details class="details details--accent" open>
            <summary>Connection Details</summary>
            <div class="details__content">
              <ul class="bullets">
                <li><strong>Host:</strong> <code>localhost</code></li>
                <li><strong>Port:</strong> <code>5432</code></li>
                <li><strong>Database:</strong> <code>uht</code></li>
                <li><strong>Username:</strong> <code>superuser</code></li>
                <li><strong>Password:</strong> <code>SYS</code></li>
                <li><strong>Driver Path:</strong> <code>/usr/share/java/postgresql-42.3.3.jar</code></li>
                <li><strong>Driver Class:</strong> <code>org.postgresql.Driver</code></li>
                <li><strong>JDBC URL:</strong> <code>jdbc:postgresql://localhost:5432/uht</code></li>
                <li><strong>Connection String:</strong> <code>postgresql://superuser:SYS@localhost:5432/uht</code></li>
              </ul>
            </div>
          </details>
    
          <div class="card card--plain">
            <!-- Unique ID for this checklist -->
            <form class="checklist" data-checklist-id="exercise-1-postgres-export">
    
              <label class="checklist__item">
                <input type="checkbox" data-step="1" />
                <span>
                  <strong>1) Install PostgreSQL</strong>
                  <pre><code>sudo apt-get update
    sudo apt-get install -y postgresql</code></pre>
                </span>
              </label>
    
              <label class="checklist__item">
                <input type="checkbox" data-step="2" />
                <span>
                  <strong>2) Start PostgreSQL service</strong>
                  <pre><code>sudo service postgresql start</code></pre>
                </span>
              </label>
    
              <label class="checklist__item">
                <input type="checkbox" data-step="3" />
                <span>
                  <strong>3) Create database and tables</strong>
                  <pre><code># Create the UHT database
    sudo -u postgres psql -c "CREATE DATABASE uht;"
    
    # Create the Patient table
    sudo -u postgres psql -d uht -c "
    CREATE TABLE patient (
        id SERIAL PRIMARY KEY,
        first_name VARCHAR(100),
        last_name VARCHAR(100),
        date_of_birth DATE,
        email VARCHAR(255),
        phone VARCHAR(20),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );"
    
    # Create the HL7Messages table
    sudo -u postgres psql -d uht -c "
    CREATE TABLE HL7Messages (
        id SERIAL PRIMARY KEY,
        Message TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );"</code></pre>
                </span>
              </label>
    
              <label class="checklist__item">
                <input type="checkbox" data-step="4" />
                <span>
                  <strong>4) Create PostgreSQL superuser and grant DB privileges</strong>
                  <pre><code>sudo -u postgres psql -c "CREATE USER superuser WITH SUPERUSER PASSWORD 'SYS';"
    sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE uht TO superuser;"</code></pre>
                </span>
              </label>
    
              <label class="checklist__item">
                <input type="checkbox" data-step="5" />
                <span>
                  <strong>5) Install PostgreSQL JDBC driver</strong>
                  <pre><code>sudo apt-get install -y libpostgresql-jdbc-java</code></pre>
                  <div class="muted" style="margin-top:8px;">
                    Driver location: <code>/usr/share/java/postgresql-42.3.3.jar</code>
                  </div>
                </span>
              </label>
    
              <label class="checklist__item">
                <input type="checkbox" data-step="6" />
                <span>
                  <strong>6) Test connection</strong>
                  <pre><code>PGPASSWORD='SYS' psql -h localhost -p 5432 -U superuser -d uht -c "SELECT 1;"</code></pre>
                </span>
              </label>
    
              <label class="checklist__item">
                <input type="checkbox" data-step="7" />
                <span>
                  <strong>7) Example queries (optional)</strong>
                  <pre><code>-- Select all patients
    SELECT * FROM patient;
    
    -- Select latest HL7 message
    SELECT * FROM HL7Messages ORDER BY id DESC LIMIT 1;
    
    -- Insert HL7 message
    INSERT INTO HL7Messages (Message) VALUES (?);</code></pre>
                </span>
              </label>
    
              <div class="checklist__actions">
                <button class="btn" type="button" data-reset-checklist>Reset checklist</button>
              </div>
            </form>
          </div>
        </section>
    
  </main>

  <footer class="footer">
    <div class="container footer__inner">
      <span class="muted">Exercise 1</span>
    </div>
  </footer>

  <script src="../assets/js/app.js"></script>
</body>
</html>
