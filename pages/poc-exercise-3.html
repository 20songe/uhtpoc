<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Exercise 3 Guide</title>
  <link rel="stylesheet" href="../assets/css/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="container topbar__inner">
      <div class="brand">
        <img class="brand__mark" src="../assets/images/logo.svg" alt="POC Hub"/>
        <div class="brand__text">
          <div class="brand__title">POC Hub</div>
          <div class="brand__subtitle">InterSystems IRIS for Health • Exercise 3</div>
        </div>
      </div>

      <nav class="quicklinks" aria-label="Quick links">
        <a class="chip" href="../index.html">Back to Home</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- HERO (matches installation guide structure) -->
    <section class="hero">
      <h1>POC Exercise 3: Intermediate Data Model Transformation Pipeline</h1>
      <p>
        Use the instructions on this page to complete the exercise. The checklists can track progress (saved in browser).
      </p>
    </section>

    <!-- OVERVIEW / SUCCESS -->
    <section class="section">
      <div class="section__header">
        <h2>Exercise Overview</h2>
        <p class="muted">Unity Health Toronto is seeking to transform HL7v2 messages, FHIR resources, and CDA documents into SQL tables quickly and efficiently.</p>
        <br/>
        <p class="muted">In this exercise, we will demonstrate how we can leverage InterSystems’ internal data model, Summary Document Architecture (SDA), and pre-built transformations to build a pipeline transforming HL7v2, FHIR, and CDA into a relational table via an intermediate data model. This exercise will demonstrate the simplicity an intermediate data model provides for transforming from multiple healthcare data standards into a single tabular output.</p>
        <br/>
      </div>

      <details class="details details--accent" >
        <summary>Measures of Success</summary>
        <div class="details__content">
          <ul class="bullets">
            <li>Successful ingestion of all three healthcare data standards</li>
            <li>Successful transformation of this healthcare data into SDA and then a SQL table</li>
            <li>Successful access to the tabular data</li>
          </ul>
          <p class="muted" style="margin-top:10px;">
            Validation of this success will be accomplished using tools available through IRIS (Visual Trace, SQL Engine) and an external SQL database (PostgreSQL).
          </p>
        </div>
      </details>
    </section>

    <!-- PRE-REQUISITES -->
    <section id="prereqs" class="section">
      <div class="section__header">
        <h2>Pre-requisites</h2>
        <p class="muted">Complete these prerequisites before building the interoperability pipeline.</p>
      </div>

      <details class="details details--accent">
        <summary>Pre-requisites</summary>
        <br/>

        <form class="checklist" data-checklist-id="exercise-1-prereqs">

          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span>
              <strong>1.</strong> Click on the gear icon in the lower left-hand corner of VS Code. Select <code>Settings</code>.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>2.</strong> Search for "compile".

              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <p class="muted">
                    <img src="../assets/images/exercise3/3-vs-code.png" alt="VS Code Settings" />
                </div>
              </details>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>3.</strong> Make sure the <strong>ObjectScript: Compile Flags</strong> setting is set to:
              <pre><code>cukd</code></pre>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>4.</strong> Make sure the <strong>ObjectScript: Compile On Save</strong> setting is checked.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="5" />
            <span>
              <strong>5.</strong> In VS Code, connect to your IRIS for Health Instance and navigate to the uhtpoc.Encounter and uhtpoc.Patient classes. Make sure they both extend:
              <pre><code>(%Persistent, %XML.Adaptor)</code></pre>

              Save the file (<code>CTRL+S</code>) to automatically re-compile these classes.

              This will display your custom classes nicely in the Visual Trace and allow you to run tests on individual data transformations (we will see this in later optional, but highly recommended sections).

              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <p class="muted">
                    See Exercise 1: (Optional) View SQL Tables as Object Classes in VS Code for more detailed instruction.

                    To connect to IRIS via VS Code, click on the InterSystems logo on the left-side panel. Select your IRIS instance from the <code>All Servers</code> dropdown to connect (enter your IRIS for Health password when prompted).
                  Click on the pencil icon next to your chosen namespace. Click on the top <code>Explorer</code> icon on the left-side panel to view the namespace as a directory in your workspace.</p>
                  <img src="../assets/images/exercise3/1-vs-code.png" alt="Connect VS Code" />
                </div>
              </details>

              <details class="hint">
                <summary>Output</summary>
                <div class="hint__content">
                  <p class="muted">
                    Header for the Patient class.
                    </p>
                  <img src="../assets/images/exercise3/2-vs-code.png" alt="Edit class" />
                </div>
              </details>
            </span>
          </label>


          <label class="checklist__item">
            <input type="checkbox" data-step="6" />
            <span>
              <strong>6.</strong> Create the following directory in your Google VM (remember to replace &lt;USER&gt; below with the user who installed/owns the IRIS instance):
              <pre><code>sudo mkdir -p /isc/MessageIn/CCDA
sudo chown -R &lt;USER&gt;:irisusr /isc/MessageIn/
sudo chmod -R 775 /isc/MessageIn/</code></pre>
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
        </form>
      </details>

    </section>

    <!-- Create Data Transformations -->
    <section id="transformation" class="section">
      <div class="section__header">
        <h2>Intermediate Data Model Transformation</h2>
        <p class="muted">Build transformations from the internal data model, Summary Document Architecture (SDA), to our custom Encounter and Patient classes. This allows us to build a single transformation from SDA to our downstream data formats, rather than point-to-point transformations from HL7v2, FHIR, and CDA into the custom data formats.</p>
      </div>

      <details class="details details--accent">
        <summary>Create Gender Lookup Table</summary>

        <div class="details__content">
          <p class="muted">We will create a lookup table for converting codes into specified values. This lookup table will be used in a later data transformation (for the encounter data).</p>
        </div>

        <form class="checklist" data-checklist-id="exercise-3-lookup-table">
          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span>
              <strong>1.</strong> From the homepage of the Management Portal, select your namespace (i.e. <code>UNITY</code>).
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>2.</strong> Navigate to Interoperability → Configure → Data Lookup Tables.
              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <img src="../assets/images/exercise3/4-management-portal.png" alt="Data Lookup Tables" />
                </div>
              </details>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>3.</strong> Click <code>New</code> at the top of the screen to create a new lookup table.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>4.</strong> In the pop-up, configure the following:
              <ul class="bullets">
                <li><strong>New lookup table name:</strong> Gender</li>
                <li>Click <code>OK</code>.</li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="5" />
            <span>
              <strong>5.</strong> On the right-side panel, configure the following (this means that when we encounter the code "M" for gender, the lookup table will allow us to change that value to "Male"):
              <ul class="bullets">
                <li><strong>Key:</strong> M</li>
                <li><strong>Value:</strong> Male</li>
                <li>Click Apply. You should see a new entry appear in your table at the center of the screen.</li>
              </ul>

              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <img src="../assets/images/exercise3/5-data-lookup.png" alt="Data Lookup Tables" />
                </div>
              </details>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="6" />
            <span>
              <strong>6.</strong> On the right-side panel, delete the previously entered text and re-configure as follows:
              <ul class="bullets">
                <li><strong>Key:</strong> F</li>
                <li><strong>Value:</strong> Female</li>
                <li>Click Apply. This should add a new entry to your table.</li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="7" />
            <span>
              <strong>7.</strong> At the top of the screen, click <code>Save</code> to save your new lookup table entries.
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
        </form>
      </details>

      <details class="details details--accent">
        <summary>Build Encounter Data Transformation</summary>

        <div class="details__content">
          <p class="muted">We will transform from an SDA encounter to the custom encounter class. </p>
        </div>

        <form class="checklist" data-checklist-id="exercise-3-encounter-transformation">
          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span>
              <strong>1.</strong> From the homepage of the Management Portal, select your namespace (i.e. <code>UNITY</code>).
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>2.</strong> Navigate to Interoperability → Build → Data Transformations.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>3.</strong> Create a new data transformation and configure as follows:
              <ul class="bullets">
                <li><strong>Package:</strong> UNITYPKG.DTL</li>
                <li><strong>Name:</strong> SDAEncounterToSQLEncounter</li>
                <li><strong>Source Type:</strong> <pre><code>HS.SDA3.Encounter</code></pre></li>
                <li><strong>Target Type:</strong> <pre><code>uhtpoc.Encounter</code></pre></li>
                <li>Click <code>OK</code>.</li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>4.</strong> Create a <code>set</code> action with the following configuration:
              <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.mrn</code></pre></li>
                <li><strong>Value:</strong> <pre><code>aux(1)</code></pre></li>
              </ul>

              The "aux" variable is an array used to pass values into this data transformation from another class that is calling this transformation.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="5" />
            <span>
                <strong>5.</strong> Create an <code>if</code> action. Click on the new <code>if</code> action at the bottom of the screen (this should be the second action in your list) and configure the following:       
                <ul class="bullets">
                <li><strong>Condition:</strong> <pre><code>target.data'=""</code></pre></li>
              </ul>

              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <img src="../assets/images/exercise3/6-dtl.png" alt="If condition" />
                </div>
              </details>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="6" />
            <span>
                <strong>6.</strong> With the <code>if</code> action still selected, create a <code>set</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.date</code></pre></li>
                <li><strong>Value:</strong> <pre><code>$System.SQL.TODATE(source.EnteredOn, "YYYY-MM-DD")</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="7" />
            <span>
                <strong>7.</strong> Click on the <code>else</code> action (should be the fourth action in your list at the bottom of the screen). Create a <code>set</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.date</code></pre></li>
                <li><strong>Value:</strong> <pre><code>$System.SQL.TODATE(source.FromTime, "YYYY-MM-DD")</code></pre></li>
              </ul>

              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <img src="../assets/images/exercise3/7-dtl.png" alt="If condition" />
                </div>
              </details>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="8" />
            <span>
                <strong>8.</strong> Click on the <code>endif</code> action (should be the seventh action in your list at the bottom of the screen). Create a <code>set</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.encounterNum</code></pre></li>
                <li><strong>Value:</strong> <pre><code>source.EncounterNumber</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="9" />
            <span>
                <strong>9.</strong> Create a <code>set</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.encounterType</code></pre></li>
                <li><strong>Value:</strong> <pre><code>source.EncounterType</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="10" />
            <span>
                <strong>10.</strong> Create a <code>sql</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>SQL:</strong> <pre><code>INSERT INTO uhtpoc.Encounter (mrn, date, encounterNum, encounterType) VALUES 
(target.mrn, target.date, target.encounterNum, target.encounterType)</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="11" />
            <span>
                <strong>11.</strong> Click <code>Compile.</code>
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
          </form>
      </details>

      <details class="details details--accent">
        <summary>Build Patient Data Transformation</summary>

        <div class="details__content">
          <p class="muted">We will transform from an SDA Patient to the custom patient class. </p>
        </div>

        <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span>
              <strong>1.</strong> Create a new data transformation and configure as follows:
              <ul class="bullets">
                <li><strong>Package:</strong> UNITYPKG.DTL</li>
                <li><strong>Name:</strong> SDAPatientToSQLPatient</li>
                <li><strong>Source Type:</strong> <pre><code>HS.SDA3.Patient</code></pre></li>
                <li><strong>Target Type:</strong> <pre><code>uhtpoc.Patient</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
                <strong>2.</strong> Create a <code>set</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.mrn</code></pre></li>
                <li><strong>Value:</strong> <pre><code>source.PatientNumbers.(1).Number</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
                <strong>3.</strong> Create a <code>set</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.firstname</code></pre></li>
                <li><strong>Value:</strong> <pre><code>source.Name.GivenName</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
                <strong>4.</strong> Create a <code>set</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.lastname</code></pre></li>
                <li><strong>Value:</strong> <pre><code>source.Name.FamilyName</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="5" />
            <span>
                <strong>5.</strong> Create a <code>set</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.dateofbirth</code></pre></li>
                <li><strong>Value:</strong> <pre><code>$System.SQL.TODATE(source.BirthTime,"YYYY-MM-DD")</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="5" />
            <span>
                <strong>5.</strong> Create a <code>set</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.gender</code></pre></li>
                <li><strong>Value:</strong> Click the magnifying glass next to the <code>Value</code> text box and configure the following in the pop-up wizard:
                <ul class="bullets">
                  <li><strong>Function:</strong> Lookup()</li>
                  <li><strong>table:</strong> Gender</li>
                  <li><strong>value:</strong> <pre><code>source.Gender.Code</code></pre></li>
                  <li><strong>default:</strong> <pre><code>"Unknown"</code></pre></li>
                  <li>Click <code>OK.</code></li>
                </ul></li>
              </ul>

              <details class="hint">
                <summary>Hint</summary>
                <div class="hint__content">
                  <img src="../assets/images/exercise3/8-dtl.png" alt="Lookup" />
                </div>
                <div class="hint__content">
                  <img src="../assets/images/exercise3/9-lookup-config.png" alt="Lookup" />
                </div>
              </details>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="6" />
            <span>
                <strong>6.</strong> Create a <code>set</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>Property:</strong> <pre><code>target.phone</code></pre></li>
                <li><strong>Value:</strong> <pre><code>source.ContactInfo.HomePhoneNumber</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="7" />
            <span>
                <strong>7.</strong> Create a <code>sql</code> action with the following configuration:       
                <ul class="bullets">
                <li><strong>SQL:</strong> <pre><code>INSERT INTO uhtpoc.Patient (mrn, first_name, last_name, date_of_birth, gender, phone) VALUES 
(target.mrn, target.firstname, target.lastname, target.dateofbirth, target.gender, target.phone)</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="8" />
            <span>
                <strong>8.</strong> Click <code>Compile.</code>
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
          </form>
      </details>

      <details class="details details--accent">
        <summary>(Optional) Test Patient Data Transformation</summary>
        <div class="details__content">
          <p class="muted">We will use the built-in testing tool to test our patient data transformation.</p>
        </div>

        <form class="checklist" data-checklist-id="exercise-3-optional-dtl-test">

          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span>
              <strong>1.</strong> On the right-side panel, at the top, click on the <code>Tools</code> tab.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>2.</strong> Click <code>Test.</code>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>3.</strong> In the Test Transform pop-up, replace the default input message with the following message:
<pre>
  <code>
    &lt;test&gt;
    &lt;Patient&gt;
    &lt;Name&gt;
    &lt;FamilyName&gt;Kamp&lt;/FamilyName&gt;
    &lt;GivenName&gt;David&lt;/GivenName&gt;
    &lt;Type&gt;Legal&lt;/Type&gt;
    &lt;/Name&gt;
    &lt;Gender&gt;
    &lt;SDACodingStandard&gt;AdministrativeGender&lt;/SDACodingStandard&gt;
    &lt;Code&gt;M&lt;/Code&gt;
    &lt;Description&gt;Male&lt;/Description&gt;
    &lt;/Gender&gt;
    &lt;MaritalStatus&gt;
    &lt;Code&gt;Widowed&lt;/Code&gt;
    &lt;Description&gt;Widowed&lt;/Description&gt;
    &lt;/MaritalStatus&gt;
    &lt;Races&gt;
    &lt;Race&gt;
    &lt;Code&gt;White&lt;/Code&gt;
    &lt;Description&gt;White&lt;/Description&gt;
    &lt;/Race&gt;
    &lt;/Races&gt;
    &lt;BirthTime&gt;1975-01-15T05:00:00&lt;/BirthTime&gt;
    &lt;PatientNumbers&gt;
    &lt;PatientNumber&gt;
    &lt;Number&gt;100000001&lt;/Number&gt;
    &lt;Organization&gt;
    &lt;Code&gt;1.3.6.1.4.1.21367.2010.1.2.300&lt;/Code&gt;
    &lt;Description&gt;1.3.6.1.4.1.21367.2010.1.2.300&lt;/Description&gt;
    &lt;/Organization&gt;
    &lt;NumberType&gt;MRN&lt;/NumberType&gt;
    &lt;/PatientNumber&gt;
    &lt;/PatientNumbers&gt;
    &lt;Addresses&gt;
    &lt;Address&gt;
    &lt;Street&gt;2936 State Avenue&lt;/Street&gt;
    &lt;City&gt;
    &lt;Code&gt;Manchester&lt;/Code&gt;
    &lt;/City&gt;
    &lt;State&gt;
    &lt;Code&gt;CT&lt;/Code&gt;
    &lt;/State&gt;
    &lt;Zip&gt;
    &lt;Code&gt;06040&lt;/Code&gt;
    &lt;/Zip&gt;
    &lt;Country&gt;
    &lt;Code&gt;US&lt;/Code&gt;
    &lt;/Country&gt;
    &lt;/Address&gt;
    &lt;/Addresses&gt;
    &lt;EnteredOn&gt;2026-01-22T00:48:48-05:00&lt;/EnteredOn&gt;
    &lt;/Patient&gt;
    &lt;/test&gt;

  </code>
</pre>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>4.</strong> At the top of the pop-up click <code>Test.</code> You should see your custom patient object rendered as an XML in the Output Message section.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="5" />
            <span>
              <strong>5.</strong> When you are done exploring the testing utility, click <code>Close.</code>
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
        </form>
        </details>
    </section>

    <!-- Import Business Processes -->
    <section id="business-processes" class="section">
      <div class="section__header">
        <h2>Build Business Process Classes</h2>
        <p class="muted">Build out business processes that call out-of-the-box transformations to convert from HL7v2, FHIR, and CDA into our intermediate data model (SDA). We will also focus on leveraging VS Code for more flexible integration pipeline development.</p>
      </div>

      <details class="details details--accent">
        <summary>Import Classes</summary>

        <div class="details__content">
          <p class="muted">We will import partially built business process classes.</p>
        </div>

        <form class="checklist" data-checklist-id="exercise-3-import-business-processes">
          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span>
              <strong>1.</strong> Download this export, which contains two partially completed business process classes. 
              The <code>UNITYPKG.Process.MasterRouter</code> class includes logic for taking in any of the three types of inbound healthcare data standards and transforming them to the internal SDA data model.
              The <code>UNITYPKG.Process.SDAToSQLProcess</code> class includes logic for taking in an SDA XML message and transforming it into custom SQL tables.

              <ul>
                <li>exercise3_export.xml<a
                  href="../assets/downloads/exercise3/exercise3_export.xml"
                  download
                  target="_blank"
                  class="btn btn--icon"
                  aria-label="Download exercise3_export.xml"
                  title="Download exercise3_export.xml"
                >
                  <img
                    src="../assets/images/download.svg"
                    alt=""
                    aria-hidden="true"
                  />
                </a></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>2.</strong> From the Management Portal Home page, navigate to System Explorer → Classes.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>3.</strong> Click <code>Import</code> at the top of the page. In the pop-up, configure the following:
              <ul class="bullets">
                <li><strong>The import file resides on:</strong> My Local Machine</li>
                <li><strong>Import from a File or a Directory:</strong> File</li>
                <li><strong>Enter the path and name of the import file:</strong> &lt;Select or type in file path to your downloaded export XML file.&gt;</li>
                <li>Click <code>Next</code> and <code>Import</code>.</li>
              </ul>
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
          </form>
      </details>

      <details class="details details--accent">
        <summary>Complete Business Process Classes</summary>

        <div class="details__content">
          <p class="muted">We will leverage out-of-the-box transformations to complete our HL7v2-to-SDA, CDA-to-SDA, and FHIR-to-SDA transformations within our business processes.</p>
        </div>

        <form class="checklist" data-checklist-id="exercise-3-complete-bp-classes">
          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span>
              <strong>1.</strong> In VS Code, connect to your IRIS for Health Instance (refer to optional exercise in Exercise 1 for instructions on using VS Code with IRIS).
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>2.</strong> In the Namespaces dropdown, select <code>UNITY</code>.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>3.</strong> Navigate to your workspace (where your open directories are displayed).
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>4.</strong> Open <code>UNITYPKG.Process.MasterRouter.cls</code>.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="5" />
            <span>
              <strong>5.</strong> Use <code>CTRL+F</code> to find all the comments that start with <code>TODO</code>. There should be three in total. These are lines of code we need to fill in.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="6" />
            <span>
              <strong>6.</strong> The first <code>TODO</code> tells us to "Call the /SDA3/CCDAv21-to-SDA.xsl XSLT." 
              We will use the transformer we instantiated (class: HS.Util.XSLTTransformer) three lines of code before to transform from CCDA to SDA using an XML stylesheet transformation (XSLT).
              This XSLT comes out-of-the-box with your IRIS for Health Installation.
              
              Add the following line of code below the <code>TODO</code> comment:
              <pre><code>Set status = transformer.Transform(cdaStream,"/SDA3/CCDAv21-to-SDA.xsl", .sdaStream)</code></pre>

              The parameters for the <code>Transform</code> function above are:
              <ul class="bullets">
                <li><strong>pInput:</strong> the stream containing CDA data to transform (<code>cdaStream</code> above)</li>
                <li><strong>pLocation:</strong> the relative filepath to your XSLT transformation (<code>"/SDA3/CCDAv21-to-SDA.xsl"</code>)</li>
                <li><strong>pOutput:</strong> the stream to write the output SDA into, by reference (<code>.sdaStream</code>)</li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="7" />
            <span>
              <strong>7.</strong> The second <code>TODO</code> tells us to "Call the HL7 to SDA3 transformation." 
              
              Add the following line of code below the <code>TODO</code> comment (for documentation, <code><a href="https://docs.intersystems.com/healthconnectlatest/csp/documatic/%25CSP.Documatic.cls?LIBRARY=HSLIB&CLASSNAME=HS.Gateway.HL7.HL7ToSDA3#METHOD_GetSDA" target="_blank">click here</a></code>):
              <pre><code>Set status = ##class(HS.Gateway.HL7.HL7ToSDA3).GetSDA(request, .sdaStream)</code></pre>

              The parameters for the <code>GetSDA</code> function above are:
              <ul class="bullets">
                <li><strong>pRequest:</strong> the input HL7 message (<code>request</code> above)</li>
                <li><strong>pXML:</strong> the stream to write the output SDA into, by reference (<code>.sdaStream</code>)</li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="8" />
            <span>
              <strong>8.</strong> The third <code>TODO</code> tells us to "Send output message to downstream target." 
              
              Add the following line of code below the <code>TODO</code> comment (for documentation, <code><a href="https://docs.intersystems.com/healthconnect20253/csp/documatic/%25CSP.Documatic.cls?LIBRARY=ENSLIB&CLASSNAME=Ens.BusinessProcess#METHOD_SendRequestSync" target="_blank">click here</a></code>):
              <pre><code>Set status = ..SendRequestSync(..TargetConfigName, outputMessage, .tResponse, 10)</code></pre>

              The parameters for the <code>SendRequestSync</code> function above are:
              <ul class="bullets">
                <li><strong>pTargetDispatchName:</strong> the downstream production component to send the message to (<code>..TargetConfigName</code> above)</li>
                <li><strong>pRequest:</strong> the message to send (<code>outputMessage</code>)</li>
                <li><strong>pResponse:</strong> the response returned by the downstream production component, by reference (<code>.tResponse</code>)</li>
                <li><strong>pTimeout</strong> timeout in seconds (<code>10</code> above)</li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="9" />
            <span>
              <strong>9.</strong> Save the file (<code>CTRL+S</code>). This should also compile the class.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="10" />
            <span>
              <strong>10.</strong> Open <code>UNITYPKG.Process.SDAToSQLProcess.cls</code>. Use <code>CTRL+F</code> to find all the comments that start with <code>TODO</code>. There should be four in total. These are lines of code we need to fill in.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="11" />
            <span>
              <strong>11.</strong> The first <code>TODO</code> tells us to "Use the Transform method of the PatientTransformationClass setting." 
              
              Add the following line of code below the <code>TODO</code> comment (for documentation on the <code>$CLASSMETHOD</code> method below, <code><a href="https://docs.intersystems.com/healthconnect20253/csp/docbook/Doc.View.cls?KEY=RCOS_fclassmethod" target="_blank">click here</a></code>):
              <pre><code>Set sc = $CLASSMETHOD(..PatientTransformationClass, "Transform", obj, .target)</code></pre>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="12" />
            <span>
              <strong>12.</strong> The second <code>TODO</code> tells us to "Send the output from our SDA to SQL Patient transformation to the downstream target." 
              
              Add the following line of code below the <code>TODO</code> comment:
              <pre><code>Set status = ..SendRequestSync(..PatientTargetConfigName, target, .response, 10)</code></pre>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="13" />
            <span>
              <strong>13.</strong> The third <code>TODO</code> tells us to "Use the Transform method of the EncounterTransformationClass setting." 
              
              Add the following line of code below the <code>TODO</code> comment:
              <pre><code>Set sc = $CLASSMETHOD(..EncounterTransformationClass, "Transform", obj, .target, .var)</code></pre>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="14" />
            <span>
              <strong>14.</strong> The fourth <code>TODO</code> tells us to "Use the Transform method of the EncounterTransformationClass setting." 
              
              Add the following line of code below the <code>TODO</code> comment:
              <pre><code>Set status = ..SendRequestSync(..EncounterTargetConfigName, target, .response, 10)</code></pre>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="15" />
            <span>
              <strong>15.</strong> Save the file (<code>CTRL+S</code>). This should also compile the class.
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
          </form>
      </details>
    </section>

    <!-- COMPLETE INTEROPERABILITY PIPELINE -->
    <section id="interop-pipeline" class="section">
      <div class="section__header">
        <h2>Complete Interoperability Production</h2>
        <p class="muted">Incorporate our business processes and reconfigure our production to leverage these processes to transform from various healthcare data standards to SQL tables via our intermediate data model, SDA.</p>
      </div>

      <details class="details details--accent">
        <summary>Add Business Processes to Interoperability Production</summary>

        <div class="details__content">
          <p class="muted">We will add new business processes to our interoperability production.</p>
        </div>

        <form class="checklist" data-checklist-id="exercise-3-add-bp-interop-production">
          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span>
              <strong>1.</strong> Add a new business process and configure as follows (in the All Processes tab):
              <ul class="bullets">
                <li><strong>Business Process Class:</strong> UNITYPKG.Process.MasterRouter</li>
                <li><strong>Business Process Name:</strong> MasterRouter</li>
                <li><strong>Display Category:</strong> Exercise 3</li>
                <li><strong>Enabled:</strong> checked</li>
                <li>Click <code>OK.</code></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>2.</strong> Add a new business process and configure as follows (in the All Processes tab):
              <ul class="bullets">
                <li><strong>Business Process Name:</strong> UNITYPKG.Process.SDAtoSQLProcess</li>
                <li><strong>Business Process Name:</strong> SDAToSQLProcess</li>
                <li><strong>Display Category:</strong> Exercise 3</li>
                <li><strong>Enabled:</strong> checked</li>
                <li>Click <code>OK.</code></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>3.</strong> Click on the newly created <code>MasterRouter</code> process. In the right-side panel, configure as follows:
              <ul class="bullets">
                <li><strong>Target Config Name:</strong> SDAToSQLProcess</li>
                <li>Click <code>Apply.</code></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>4.</strong> Click on the newly created <code>SDAToSQLProcess</code> process. In the right-side panel, configure as follows:
              <ul class="bullets">
                <li><strong>PatientTransformationClass:</strong> UNITYPKG.DTL.SDAPatientToSQLPatient</li>
                <li><strong>PatientTargetConfigName:</strong> PostgreSQLPatient</li>
                <li><strong>EncounterTransformationClass:</strong> UNITYPKG.DTL.SDAEncounterToSQLEncounter</li>
                <li><strong>EncounterTargetConfigName:</strong> PostgreSQLEncounter</li>
                <li>Click <code>Apply.</code></li>
              </ul>
            </span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
          </form>
      </details>


      <details class="details details--accent">
        <summary>Add/Reconfigure Relevant Business Services</summary>

        <div class="details__content">
          <p class="muted">We will add new business services and reconfigure existing ones to feed our new business processes.</p>
        </div>

        <form class="checklist" data-checklist-id="exercise-3-add-bp-interop-production">
          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span>
              <strong>1.</strong> Add a new business service and configure as follows (in the All Processes tab):
              <ul class="bullets">
                <li><strong>Service Class:</strong> EnsLib.EDI.XML.Service.FileService</li>
                <li><strong>Service Name:</strong> CDAFileIn</li>
                <li><strong>Display Category:</strong> Exercise 3</li>
                <li><strong>Enabled:</strong> checked</li>
                <li>Click <code>OK.</code></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <span>
              <strong>2.</strong> Click on the new <code>CDAFileIn</code> service and configure the following (under Basic Settings):
              <ul class="bullets">
                <li><strong>File Path:</strong> /isc/MessageIn/CCDA/</li>
                <li><strong>Target Config Names:</strong> MasterRouter</li>
                <li>Click <code>OK.</code></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span>
              <strong>3.</strong> Click on the existing <code>FHIRIn</code> service and configure the following (under Basic Settings):
              <ul class="bullets">
                <li><strong>Target Config Name:</strong> MasterRouter (replace FHIRRouter)</li>
                <li>Click <code>OK.</code></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>4.</strong> Click on the existing <code>HL7FileIn</code> service and configure the following (under Basic Settings):
              <ul class="bullets">
                <li><strong>Target Config Names:</strong> MasterRouter (replace HL7Router)</li>
                <li>Click <code>OK.</code></li>
              </ul>
            </span>
          </label>


          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
          </form>
      </details>
    </section>


    <!-- DATA INGESTION AND VALIDATION -->
    <section id="validate" class="section">
      <div class="section__header">
        <h2>Data Ingestion and Validation</h2>
        <p class="muted">Feed data through the production and validate IRIS + PostgreSQL tables.</p>
      </div>

      <details class="details details--accent">
        <summary>Data Ingestion and Validation</summary>
        <br/>

        <form class="checklist" data-checklist-id="exercise-1-validate">

          <div class="details__content">
            <p class="muted">In this section, we will feed three types of healthcare data (HL7v2, FHIR, CDA) through the interoperability production and validate that it has populated our SQL tables.</p>
          </div>

          <label class="checklist__item">
            <input type="checkbox" data-step="1" />
            <span><strong>1. </strong>If the production isn't already started yet, click the <code>Start</code> button on the production configuration page.</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="2" />
            <!-- TODO: make these folders -->
            <span><strong>2. </strong>Download this data for exercise 3: 
              <ul>
                <li>exercise3_ADT^A01.hl7.txt  <a
                  href="../assets/downloads/exercise3/exercise3_ADT^A01.hl7.txt"
                  download
                  target="_blank"
                  class="btn btn--icon"
                  aria-label="Download exercise3_ADT^A01.hl7.txt"
                  title="Download exercise3_ADT^A01.hl7.txt"
                >
                  <img
                    src="../assets/images/download.svg"
                    alt=""
                    aria-hidden="true"
                  />
                </a></li>

                <li>exercise3_ADT^A02.hl7.txt  <a
                  href="../assets/downloads/exercise3/exercise3_ADT^A02.hl7.txt"
                  download
                  target="_blank"
                  class="btn btn--icon"
                  aria-label="Download exercise3_ADT^A02.hl7.txt"
                  title="Download exercise3_ADT^A02.hl7.txt"
                >
                  <img
                    src="../assets/images/download.svg"
                    alt=""
                    aria-hidden="true"
                  />
                </a></li>

                <li>exercise3_ADT^A03.hl7.txt  <a
                  href="../assets/downloads/exercise3/exercise3_ADT^A03.hl7.txt"
                  download
                  target="_blank"
                  class="btn btn--icon"
                  aria-label="Download exercise3_ADT^A03.hl7.txt"
                  title="Download exercise3_ADT^A03.hl7.txt"
                >
                  <img
                    src="../assets/images/download.svg"
                    alt=""
                    aria-hidden="true"
                  />
                </a></li>

                <li>CCDA.xml<a
                  href="../assets/downloads/exercise3/CCDA.xml"
                  download
                  target="_blank"
                  class="btn btn--icon"
                  aria-label="Download CCDA.xml"
                  title="Download CCDA.xml"
                >
                  <img
                    src="../assets/images/download.svg"
                    alt=""
                    aria-hidden="true"
                  />
                </a></li>

                <li>FHIR_Bundle.txt<a
                  href="../assets/downloads/exercise3/FHIR_Bundle.txt"
                  download
                  target="_blank"
                  class="btn btn--icon"
                  aria-label="Download FHIR_Bundle.txt"
                  title="Download FHIR_Bundle.txt"
                >
                  <img
                    src="../assets/images/download.svg"
                    alt=""
                    aria-hidden="true"
                  />
                </a></li>
              </ul></span>
          </label>

          <div class="details__content">
            <p class="muted">
              We will start by ingesting FHIR data via REST.
            </p>
          </div>

          <label class="checklist__item">
            <input type="checkbox" data-step="3" />
            <span><strong>3. </strong>Create a new POST request in Postman.</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="4" />
            <span>
              <strong>4. </strong>For the URL, enter your FHIR endpoint, for example:
              <pre><code>http://&lt;hostname&gt;/irishealth/csp/healthshare/unity/fhir/r4</code></pre>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="5" />
            <span>
              <strong>5. </strong> Set the Authorization to <code>Basic Authorization</code>. Enter your IRIS username and password (i.e. SuperUser account).
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="6" />
            <span>
              <strong>6. </strong> In the Headers tab, add the following:
              <ul class="bullets">
                <li><strong>Key:</strong> <pre><code>Content-Type</code></pre></li>
                <li><strong>Value:</strong> <pre><code>application/fhir+json</code></pre></li>
              </ul>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="7" />
            <span>
              <strong>7. </strong> In the body (you can choose "raw" and "JSON"), paste the text from the <code>FHIR_Bundle.txt</code> file you downloaded earlier.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="8" />
            <span>
              <strong>8. </strong> Run the request. You should see a 201 success code, indicating the resource has been successfully posted to the FHIR Server.
            </span>
          </label>

          <div class="details__content">
            <p class="muted">
              We will now use file drops to ingest the HL7v2 messages and the CCDA document.
            </p>
          </div>

          <label class="checklist__item">
            <input type="checkbox" data-step="9" />
            <span>
              <strong>9. </strong> Upload the HL7 ADT messages and CCDA XML document that we downloaded early to the Google VM.
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="10" />
            <span>
              <strong>10. </strong> Copy the HL7 ADT messages to the <code>/isc/MessageIn/HL7/</code> directory:
              <pre><code>sudo cp ~/exercise3_*.hl7.txt /isc/MessageIn/HL7</code></pre>
            </span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="11" />
            <span>
              <strong>11. </strong> Copy the CCDA document to the <code>/isc/MessageIn/CCDA/</code> directory:
              <pre><code>sudo cp ~/CCDA.xml /isc/MessageIn/CCDA</code></pre>
            </span>
          </label>


          <div class="details__content">
            <p class="muted">
              We will validate successful data ingestion by querying the data through a built-in SQL engine in IRIS. This will surface data stored in InterSystems IRIS's embedded database.
            </p>
          </div>

          <label class="checklist__item">
            <input type="checkbox" data-step="12" />
            <span><strong>12. </strong>From the Home page of the Management Portal, navigate to System Explorer → SQL.</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="13" />
            <span><strong>13. </strong>In the text box at the center of the page, enter the following query: 
              <pre><code>SELECT * FROM uhtpoc.Patient</code></pre></span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="14" />
            <span><strong>14. </strong>Click the Execute button above the query text box.
            </span>
          </label>

          <div class="details__content">
            <p class="muted">Next, we will connect to the external PostgreSQL database to query this data outside of IRIS.</p>
          </div>

          <label class="checklist__item">
            <input type="checkbox" data-step="15" />
            <span><strong>15. </strong>In your VM terminal, run to view the new patient entries: 
              <pre><code>PGPASSWORD='SYS' psql -h localhost -p 5432 -U superuser -d uhtpoc -c "SELECT * FROM Patient;"</code></pre></span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="16" />
            <span><strong>16. </strong>In your VM terminal, run to view the new encounter entries: 
              <pre><code>PGPASSWORD='SYS' psql -h localhost -p 5432 -U superuser -d uhtpoc -c "SELECT * FROM Encounter;"</code></pre></span>
          </label>

          <div class="details__content">
            <p class="muted">
              We will view the successful conversion of CCDA to SDA to SQL through the Visual Trace.
            </p>
          </div>

          <label class="checklist__item">
            <input type="checkbox" data-step="17" />
            <span><strong>17.</strong> From the Home Page of the IRIS for Health Management Portal, navigate to Interoperability → Configure → Production.</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="18" />
            <span><strong>18.</strong> Click on the <code>CCDAFileIn</code> business service. In the right-side panel, click the <code>Messages</code> tab at the top.</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="19" />
            <span><strong>19.</strong> Click on the blue <code>Header</code> value of the top-most message. This opens up a Visual Trace in a new tab.</span>
          </label>

          <label class="checklist__item">
            <input type="checkbox" data-step="20" />
            <span><strong>20.</strong> From the left-side, you can click on different permutations of the message as it travelled through the interoperability production. To see the contents of each message, select the <code>Contents</code> tab at the top of the right-side panel.</span>
          </label>

          <div class="checklist__actions">
            <button class="btn" type="button" data-reset-checklist>Reset section</button>
          </div>
        </form>
      </details>
    </section>
  </main>

  <footer class="footer">
    <div class="container footer__inner">
      <span class="muted">Exercise 3</span>
      <span class="muted">Progress saved locally</span>
    </div>
  </footer>

  <script src="../assets/js/app.js"></script>
</body>
</html>
